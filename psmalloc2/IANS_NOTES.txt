
1. mmapped memory is not associated with an arena, but we will need to
put it's metadata somewhere... that could make the lookup function a
bit ugly... since given a chunk we do not really know if it is mmapped
until we see it metadata, and to find it's metadata ....

have a bad feeling that any solution is going to involve locks ...

for example we could put all mmapped memory in the main arena.
then when we use

arena_for_chunk(ptr)

that is based on

heap_for_ptr(ptr)

we need to find out that this is not an arena in our cyclic list.
but touching that list requires the lock :-(

one possibility that we mentioned in the designfest meeting was to
retain some innocuous metadata such as this.


2.  over the break I have two alternatives. work on the multi arena case
that is complicated by the above problems. Or work on the single arena case
which is probably simpler (i.e. dsmallocish) but not as productive. Decisions decisions.
Not my strong suit.


OK taking the route of least resistance:  doing it with one arena first...


3. Plan of attack: Working in the !USE_ARENAS case.

  - get av->top under control

  - use free and realloc to spot chunks with no metadata

  - handle the allocations: malloc (_int_malloc) calloc, realloc, memalign

  - handle the frees (_int_free, malloc_consolidate )

  - handle the rest (systrim, cfree, valloc, pvalloc, icalloc, icomalloc ...)


4. Mysteries

   - call to hook in _int_calloc


 
5. Need to have some tests for the odd ball members of the malloc clan. 
